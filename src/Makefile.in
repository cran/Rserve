SFILES = $(wildcard *.c)
XFILES = Rserve Rserve.dbg Rserve.so

# modify these variables to match your setup
Rhome = @R_HOME@
port  = .
LIBS  = @LIBS@

# if you have some non-standard setup you might want to modify those as well
Rincludes = $(Rhome)/include
Rlib      = -L$(Rhome)/bin -L$(Rhome)/lib
Rbin      = $(Rhome)/bin
linkR     = -lR
linkRln   = @LINK_READLINE@

PKG_CFLAGS += -DDAEMON -Iinclude -I$(Rincludes) -I$(port)

all:	$(XFILES)
	# if we got that far Rserve is compiled, so install it since
	# this is Makefile for the package version
	# it may fail, but that won't stop the make
	-cp $(XFILES) $(Rbin)
	# .. and put them in inst (so we can launch it from R if necessary)
	cp $(XFILES) ../inst

install: $(XFILES)
	-cp Rserve $(Rbin)
	-cp Rserve.dbg $(Rbin)

Rserve:	Rserv.o session.o md5.o
	$(CC) $^ -o $@ $(linkR) $(Rlib) $(LIBS)

Rserv_d.o: Rserv.c Rsrv.h
	$(CC) -c Rserv.c -o $@ -DNODAEMON -DRSERV_DEBUG -g $(PKG_CFLAGS) $(CPPFLAGS) $(CFLAGS)

Rserve.dbg:	Rserv_d.o session.o md5.o
	$(CC) $^ -o $@ $(linkR) $(Rlib) $(LIBS)

# this is fake for now - we should switch to Makevars.in and compile a proper library
Rserve.so: Rserve
	cp $^ $@

client:
	make -C client

clean:
	rm -f *~ *.o *.lo *.so \#* $(XFILES)

.PHONY: client clean
